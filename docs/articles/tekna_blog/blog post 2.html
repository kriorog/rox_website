<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kristjan Röx">
<meta name="dcterms.date" content="2025-09-01">

<title>Aircraft W&amp;B - Part 2 - An element of efficiency</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../figures/rox_logo_transparent.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2fa0555fe88427c29efa1b60aaf9e62d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-07324dbeab386b933f1773ca57cc7825.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../figures/rox_logo_transparent.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kristjanrox/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:kriorog@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Aircraft W&amp;B - Part 2 - An element of efficiency</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kristjan Röx </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 1, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#how-does-wb-affect-operational-efficiency" id="toc-how-does-wb-affect-operational-efficiency" class="nav-link active" data-scroll-target="#how-does-wb-affect-operational-efficiency">How does W&amp;B affect operational efficiency?</a></li>
  <li><a href="#certain-cg-locations-are-better-than-others" id="toc-certain-cg-locations-are-better-than-others" class="nav-link" data-scroll-target="#certain-cg-locations-are-better-than-others">Certain CG locations are better than others</a></li>
  <li><a href="#loading-ergonomics" id="toc-loading-ergonomics" class="nav-link" data-scroll-target="#loading-ergonomics">Loading ergonomics</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In Part 1 of this series - the fundamental requirements and building blocks of aircraft weight &amp; balance were introduced.</p>
<p>The key take-away was that weight and balance is <strong>a key element in aviation safety</strong>.</p>
<p>The establishment of weight and balance as a matter of safety only focused on the aircraft’s weight and Center of Gravity (CG) being inside the weight and balance envelope.</p>
<p>This is a binary requirement, i.e.&nbsp;either it is inside the envelope or outside. No consideration was made to where inside the envelope the aircraft CG was, as that was not a concern for safety.</p>
<p>In this Part 2 of the series - we’ll investigate how CG certain locations inside the envelope are better than others and how an aircraft’s weight and balance affects operational efficiency.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A few things to keep in mind
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">the first thing</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">the second thing</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>A certain CG should always be considered for an associated aircraft weight. The limits on allowable CG vary with weight.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>We are typically only concerned with longitudinal CG, i.e.&nbsp;the location of the CG along the fuselage between nose to tail.</p>
<p>Lateral CG also exists, but is typically not a concern for passenger aircraft, since load is distributed sufficiently symmetrically across the longitudinal axis of the aircraft.</p>
<p>For cargo aircraft, lateral CG may also be evaluated and compared with associated limits.</p>
<p>In this article - we’ll be discussing only longitudinal CG.</p>
</div>
</div>
</div>
</div>
</div>
<section id="how-does-wb-affect-operational-efficiency" class="level2">
<h2 class="anchored" data-anchor-id="how-does-wb-affect-operational-efficiency">How does W&amp;B affect operational efficiency?</h2>
<p>The weight and balance of an aircraft will affect two aspects of operational efficiency:</p>
<ol type="1">
<li><p>Firstly, the aircraft CG, which is determined by the load distribution, affects the fuel efficiency of the aircraft in flight. Therefore, certain CG locations are better than others.</p></li>
<li><p>Secondly, the distribution of load on an aircraft determines the process of loading and unloading the aircraft before and after flight respectively, which then affects the same process on the next flight of the aircraft and so on. Certain items have higher priority than others, and must be able to be offloaded first.<br>
<br>
Overall, efficient loading and unloading processes strike a balance between the time they take and how many resources they required.<br>
<br>
We’ll refer to this aspect of efficiency as <em>loading ergonomics</em>.</p></li>
</ol>
<p>We’ll look into each of these aspect in more detail.</p>
</section>
<section id="certain-cg-locations-are-better-than-others" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="certain-cg-locations-are-better-than-others">Certain CG locations are better than others</h2>
<p>CG locations further aft along the aircraft fuselage are better.</p>
<p><strong>Question:</strong> In what sense are aft CG locations better?</p>
<p><strong>Answer:</strong> Aft CG reduces the aircraft’s aerodynamic drag, which then reduces the required thrust from the engine, which saves fuel.</p>
<p>To explain why this is the case, we need some physics and math. If that is not your forte, then please follow along regardless, as there is commentary provided along the way.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">The math</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">More lift, more drag</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Tying it all together</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Consider a transport aircraft with weight <span class="math inline">\(W\)</span> in steady and level flight at an angle of attack <span class="math inline">\(\alpha\)</span> relative to the oncoming airflow. The below figure shows such an aircraft and the forces acting on it due to the wings and tail, and due to its own weight. For our demonstration, we only need to consider those forces.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="force_model.png" class="img-fluid figure-img"></p>
<figcaption>A typical transport aircraft in steady flight.</figcaption>
</figure>
</div>
<p>The lift <span class="math inline">\(L_w\)</span> and moment <span class="math inline">\(M_w\)</span> from the wing are applied at the same point - the aerodynamic center of the wing. Similarly, the lift <span class="math inline">\(L_t\)</span> and moment <span class="math inline">\(M_t\)</span>of the tail are calculated at the aerodynamic center of the tail.</p>
<p>The aerodynamic center of a lifting surface is a <em>point of convenience</em>. The convenience associated with this point is that the moment <span class="math inline">\(M\)</span> becomes independent of the angle of attack <span class="math inline">\(\alpha\)</span>. Therefore, in our model, both <span class="math inline">\(M_w\)</span> and <span class="math inline">\(M_t\)</span> are constants with respect to <span class="math inline">\(\alpha\)</span>.</p>
<p>The aerodynamic centers of the wing and tail are fixed points on the aircraft geometry, therefore we can define the distances <span class="math inline">\(s_w\)</span> and <span class="math inline">\(s_t\)</span>, which represent the distance between the CG and the aerodynamic centers of the wing and tail respectively.</p>
<p>Since the aerodynamic centers are fixed, the distance between them is also fixed. Therefore, we can also define their fixed spacing <span class="math inline">\(s = s_t-s_w\)</span>.</p>
<p>For steady state to prevail - the aircraft must be in both a force and moment equilibrium around its CG. To establish this, the sum of all forces and moments, separately, must vanish (i.e.&nbsp;be zero).</p>
<p>First, let’s look at the forces: <span class="math display">\[\begin{align}
    \sum_{\text{around CG}} \text{Forces} &amp;= L_w - L_t -W = 0 \Rightarrow \boxed{W = L_w - L_t}\\
\end{align}\]</span></p>
<p>This tells us that the total lift of the aircraft, i.e.&nbsp;the sum of lift from wing and tail, must be equal to the aircraft’s weight. The boxed relation will be used later on.</p>
<p>Next, let’s look at the moments (around the CG): <span class="math display">\[\begin{align}
    \sum_{\text{around CG}} \text{Moments}   &amp;= L_w s_w - L_t s_t + M_w - M_t = 0\\
    \Rightarrow L_w &amp;= \frac{L_t s_t - M_w + M_t}{s_w}\\
\end{align}\]</span> Here, we have re-arranged the terms of the moment equilibrium criteria and isolated the lift of the wing <span class="math inline">\(L_w\)</span>.</p>
<p>We can now use the boxed result from the force equilibrium above and replace <span class="math inline">\(L_t\)</span> with the relation <span class="math inline">\(L_t = L_w - W\)</span>. This gives us <span class="math display">\[\begin{align}
  L_w &amp;= \frac{(L_w-W)s_t - M_w + M_t}{s_w}\\
  \Rightarrow L_w\left(1 - \frac{s_t}{s_w}\right) &amp;= \frac{M_t - M_w - Ws_t}{s_w}\\
  \Rightarrow L_w &amp;= \frac{M_t - M_w - W s_t}{s_w-s_t}
\end{align}\]</span> Remembering that <span class="math inline">\(s = s_t-s_w\)</span> and thus <span class="math inline">\(-s = s_w-s_t\)</span>, we obtain <span class="math display">\[\begin{align}
  L_w &amp;= \frac{W(s_w+s) - M_t - M_w}{s}
\end{align}\]</span></p>
<p>Here we have derived a relationship between the wing’s lift <span class="math inline">\(L_w\)</span> and the CG logation relative to the wing through <span class="math inline">\(s_w\)</span>. Other parameters are constants.</p>
<p>What is interesting to investigate, is how <span class="math inline">\(L_w\)</span> changes if the CG is moved, i.e.&nbsp;if <span class="math inline">\(s_w\)</span> changes.</p>
<p>Mathematically, we do this by checking the derivative <span class="math inline">\(\frac{dL_w}{ds_t}\)</span>, which is <span class="math display">\[\frac{dL_w}{ds_w} = \frac{W}{s} &gt; 0\]</span> which is positive and constant at given weight <span class="math inline">\(W\)</span>.</p>
<p>For a finite change in the CG location <span class="math inline">\(\Delta s_w\)</span> we can then determine the associated change in the wing’s lift <span class="math inline">\(\Delta L_w\)</span> as <span class="math display">\[\Delta L_w = \frac{W}{s}\Delta s_w\]</span></p>
<p>Right…what does this tell us?</p>
<ul>
<li><p>If we move the CG forward, then <span class="math inline">\(\Delta s_w\)</span> is positive as the distance between the CG and the wing’s aerodynamic center increases. This makes <span class="math inline">\(\Delta L_w\)</span> positive, i.e.&nbsp;the <strong>lift increases</strong>.</p></li>
<li><p>If we move the CG aft, then <span class="math inline">\(\Delta s_w\)</span> is negative, and <span class="math inline">\(\Delta L_w\)</span> is also negative, i.e.&nbsp;the <strong>lift decreases</strong>.</p></li>
</ul>
<p>Therefore, a more forward CG location requires the wing to generate more lift.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>We have established that a more forward CG requires more lift from the wing.</p>
<p>The fuel burn of an aircraft is determined by the required thrust <span class="math inline">\(T\)</span> from the engines. For steady flight, the thrust <span class="math inline">\(T\)</span> must be equal to the drag <span class="math inline">\(D\)</span>.</p>
<p>The total drag of an aircraft in steady flight can be modelled with its drag polar as <span class="math display">\[D = qS_w\left(C_{D0} + k_wC_{Lw}^2 + k_t\frac{S_t}{S_w}C_{Lt}^2\right)\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(C_{D0}\)</span> is the zero-lift drag of the aircraft.</p></li>
<li><p><span class="math inline">\(k_w C_{Lw}^2\)</span> and <span class="math inline">\(k_t\frac{S_t}{S_w}C_{Lt}^2\)</span> are the <strong>lift-induced drag</strong> components of the wing and tail respectively.</p></li>
<li><p><span class="math inline">\(k_w\)</span> and <span class="math inline">\(k_t\)</span> are efficiency factors of the wing and tail lifting surfaces respectively.</p></li>
<li><p><span class="math inline">\(C_{Lw}\)</span> and <span class="math inline">\(C_{Lt}\)</span> are the lift-coefficients of the wing and tail respectively.</p></li>
<li><p><span class="math inline">\(S_w\)</span> and <span class="math inline">\(S_t\)</span> are the reference surface areas of the wing and tail respectively.</p></li>
<li><p><span class="math inline">\(q\)</span> is dynamic pressure.</p></li>
</ul>
<p>As the wing is a much larger lifting surface than the tail, its contribution to lift-induced drag is also much larger. Therefore, the drag polar can be simplified, without loss of generality, to <span class="math display">\[ D = qS_w \left(C_{D0} + k_w C_{Lw}^2 \right) \]</span> This is also the reason we focued on <span class="math inline">\(L_w\)</span> in the previous section.</p>
<p>The wing lift from before, <span class="math inline">\(L_w\)</span>, can be written as <span class="math display">\[ L_w = qS_{w}C_{Lw} \]</span></p>
<p>So, at constant dynamic pressure <span class="math inline">\(q\)</span> (i.e.&nbsp;fixed altitude and speed), more lift <span class="math inline">\(L_w\)</span> is requires a larger <span class="math inline">\(C_{Lw}\)</span> (i.e.&nbsp;a higher angle of attack <span class="math inline">\(\alpha\)</span>).</p>
<p>We are now interested in the change in drag with lift, i.e.&nbsp;the derivative <span class="math inline">\(\frac{dD}{dC_{Lw}}\)</span>.</p>
<p>Taking the derivative of the simplified drag polar with respect the <span class="math inline">\(C_{Lw}\)</span> we obtain <span class="math display">\[\frac{dD}{dC_{Lw}} = \left(\frac{2k_w}{qS_w}\right)C_{Lw}\]</span> where the bracketed term is always positive and <span class="math inline">\(C_{Lw}&gt;0\)</span> for positive lift.</p>
<p>Therefore, a finite increase in the wing lift through the lift coefficient <span class="math inline">\(\Delta C_{Lw}\)</span> yields a finite change in drag <span class="math inline">\(\Delta D\)</span></p>
<p><span class="math display">\[\Delta D = \left(\frac{2k_w}{qS_w}C_{Lw}\right) \Delta C_{Lw}\]</span></p>
<p>For an increase in lift, i.e.&nbsp;<span class="math inline">\(\Delta C_{Lw} &gt; 0\)</span>, then <span class="math inline">\(\Delta D &gt;0\)</span> representing an increase in drag.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>At last, we have shown that a more forward CG requires more lift from the aircraft’s wing.</p>
<p>We have also shown that a higher lift from the wing results in higher drag on the aircraft, as it causes higher lift-induced drag.</p>
<p>The higher drag will require higher thrust from the engines to maintain steady flight.</p>
<p>Consequently, higher thrust requires more fuel burn.</p>
</div>
</div>
</div>
</section>
<section id="loading-ergonomics" class="level2">
<h2 class="anchored" data-anchor-id="loading-ergonomics">Loading ergonomics</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.kristjanrox\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright Kristjan Röx. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>